apply plugin: 'groovy'
apply plugin: 'local-dev'
apply plugin: io.ehdev.conrad.gradle.SpringRestDocPlugin
apply from: "$rootDir/gradle/publishing-base.gradle"

dependencies {
    compile project(':api:rest-model')
    compile project(':auth:authentication:jwt')
    compile project(':database:database-api')
    compile project(':web-service:version-management')

    compile libraries.cglib
    compile libraries.springWeb

    compile libraries.springAop
    compile libraries.aspectJ

    compile libraries.springSecurityCore
    compile libraries.servletApi
    compile libraries.jackson

    compile 'io.swagger:swagger-annotations:1.5.8'

    compile "com.fasterxml.jackson.module:jackson-module-kotlin:2.7.2"
    compile 'javax.validation:validation-api:1.1.0.Final'
    compile 'org.hibernate:hibernate-validator:5.0.1.Final'
    compile 'org.springframework.hateoas:spring-hateoas:0.19.0.RELEASE'

    testCompile project(':database:database-test')

    testCompile libraries.groovy
    testCompile libraries.spock
    testCompile libraries.spockSpring

    testCompile libraries.springTest
    testCompile libraries.jsonPath

    testCompile libraries.testing


    integTestCompile project(':database:database-impl')
    integTestCompile libraries.springBoot
    integTestCompile libraries.springBootTest
    integTestCompile 'javax.transaction:javax.transaction-api:1.2'

    apiTestCompile 'io.springfox:springfox-swagger2:2.4.0',  'io.springfox:springfox-staticdocs:2.4.0'
    apiTestCompile project(':database:database-impl')
    apiTestCompile libraries.springBoot
    apiTestCompile libraries.springBootTest
    apiTestCompile 'javax.transaction:javax.transaction-api:1.2'
    apiTestCompile project(':test-utils')
}

configurations {
    swagger
}

def swaggerJson = new File(buildDir, 'swagger.json')

publishing {
    publications {
        swaggerDef(MavenPublication) {
            artifact(swaggerJson) {
                classifier "swagger"
            }
        }
    }
}

artifacts {
    swagger(swaggerJson) {
        type 'json'
        builtBy apiTest
    }
}

apiTest {
    systemProperty 'swagger.file', swaggerJson.absolutePath
}
