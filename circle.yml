machine:
    java:
        version: oraclejdk8
    services:
        - docker
        - postgresql
    environment:
        SPRING_DATASOURCE_URL: jdbc:postgresql://localhost/circle_test
        SPRING_DATASOURCE_USERNAME: ubuntu
        SPRING_DATASOURCE_PASSWORD:

dependencies:
    override:
        - ./gradlew resolveDependencies --console=plain

test:
    override:
        - ./gradlew check --console=plain
    post:
        - mkdir -p $CIRCLE_ARTIFACTS/docs
        - cp -r build/docs/asciidoc/html5 $CIRCLE_ARTIFACTS/docs

        - mkdir -p $CIRCLE_ARTIFACTS/test-results
        - find build/ -maxdepth 5 -name 'TEST-*.xml' -exec cp -r {}/* $CIRCLE_ARTIFACTS/test-results \;

        - mkdir -p $CIRCLE_ARTIFACTS/coverage
        - cp -r build/reports/jacoco/testCoverage $CIRCLE_ARTIFACTS/coverage

#deployment:
#    hub:
#        branch: master
#        commands:
#            - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS ehdev-docker-dockerv2-local.artifactoryonline.com:443
#            - docker push io.ehdev.conrad/webapp
